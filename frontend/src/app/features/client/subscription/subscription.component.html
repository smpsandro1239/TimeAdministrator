<div class="subscription-container">
  <h2>Minha Subscrição</h2>
  <p>Veja os detalhes da sua subscrição atual.</p>

  <div class="loading-container" *ngIf="loading">
    <mat-spinner></mat-spinner>
    <p>Carregando dados da subscrição...</p>
  </div>

  <div class="subscription-card" *ngIf="!loading && subscription">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Detalhes da Subscrição</mat-card-title>
        <mat-card-subtitle>
          <mat-chip [color]="getSubscriptionStatus().color" selected>{{ getSubscriptionStatus().text }}</mat-chip>
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="subscription-info">
          <!-- Itera sobre os detalhes da subscrição para evitar repetição de código -->
          <div *ngFor="let detail of getSubscriptionDetailsForDisplay()" class="info-row">
            <span class="label">{{ detail.label }}:</span>
            <span class="value">
              {{ detail.isDate ? (detail.value | date:'dd/MM/yyyy') : detail.value }}
            </span>
          </div>

          <div class="info-row">
            <span class="label">Renovação automática:</span>
            <span class="value">
              <mat-icon *ngIf="subscription.autoRenew" class="auto-renew-icon">check_circle</mat-icon>
              <mat-icon *ngIf="!subscription.autoRenew" class="no-renew-icon">cancel</mat-icon>
              {{ subscription.autoRenew ? 'Ativada' : 'Desativada' }}
            </span>
          </div>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <!-- Botão de Renovar (funcionalidade futura) -->
        <button mat-raised-button color="primary" (click)="renewSubscription()" [disabled]="isRenewing || isCancelling">
          <mat-spinner *ngIf="isRenewing" diameter="20"></mat-spinner>
          <mat-icon *ngIf="!isRenewing">refresh</mat-icon>
          <span *ngIf="!isRenewing">Renovar Subscrição</span>
        </button>

        <!-- Botão de Atualizar Plano -->
        <button mat-raised-button color="accent" (click)="upgradeSubscription()" [disabled]="isRenewing || isCancelling">
          <mat-icon>upgrade</mat-icon>
          Atualizar Plano
        </button>

        <!-- Botão de Cancelar -->
        <button mat-button color="warn" (click)="cancelSubscription()" [disabled]="isRenewing || isCancelling || subscription.status === 'cancelled'">
          <mat-spinner *ngIf="isCancelling" diameter="20"></mat-spinner>
          <mat-icon *ngIf="!isCancelling">cancel</mat-icon>
          <span *ngIf="!isCancelling">
            {{ subscription.status === 'cancelled' ? 'Cancelada' : 'Cancelar Subscrição' }}
          </span>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <div class="no-subscription" *ngIf="!loading && !subscription">
    <mat-card>
      <mat-card-content class="no-subscription-content">
        <mat-icon class="large-icon">card_membership</mat-icon>
        <h3>Você não possui uma subscrição ativa</h3>
        <p>Para acessar todos os recursos, adquira uma subscrição.</p>
        <button mat-raised-button color="primary" routerLink="/client/new-subscription">
          <mat-icon>add</mat-icon>
          Adquirir Subscrição
        </button>
      </mat-card-content>
    </mat-card>
  </div>
</div>
